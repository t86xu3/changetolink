<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>
  <script type="text/javascript">
    try {
      // 從網址讀取由 Cloudflare Worker 傳來的指令
      const params = new URLSearchParams(window.location.search);
      const destination = params.get('destination'); // A 計畫目的地
      const fallback = params.get('fallback');       // B 計畫目的地

      if (destination) {
        // 如果有 B 計畫 (專為 iPhone 沒裝 Chrome 的情況設計)
        if (fallback) {
          setTimeout(function() {
            // 1.5 秒後如果還沒跳轉，就執行 B 計畫
            window.location.replace(fallback);
          }, 1500); 
        }
        
        // 優先執行 A 計畫：模擬點擊主要目的地
        const link = document.createElement('a');
        link.href = destination;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
      }
    } catch (e) {
      document.body.innerHTML = 'An error occurred during redirection.';
    }
  </script>
</body>
</html>

